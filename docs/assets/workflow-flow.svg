<svg width="1600" height="1120" viewBox="0 0 1600 1120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="runtime flow clean lanes">
  <defs>
    <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0%" stop-color="#060b15"/>
      <stop offset="50%" stop-color="#0a1322"/>
      <stop offset="100%" stop-color="#0c1725"/>
    </linearGradient>
    <linearGradient id="laneLeft" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#24160d"/>
      <stop offset="100%" stop-color="#1c130b"/>
    </linearGradient>
    <linearGradient id="laneCenter" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#0d1d1f"/>
      <stop offset="100%" stop-color="#0c171d"/>
    </linearGradient>
    <linearGradient id="laneRight" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#171426"/>
      <stop offset="100%" stop-color="#131120"/>
    </linearGradient>
    <linearGradient id="manual" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#f59e0b"/>
      <stop offset="100%" stop-color="#fb923c"/>
    </linearGradient>
    <linearGradient id="runtime" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#22d3ee"/>
      <stop offset="100%" stop-color="#34d399"/>
    </linearGradient>
    <linearGradient id="ok" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#22c55e"/>
      <stop offset="100%" stop-color="#34d399"/>
    </linearGradient>
    <linearGradient id="bad" x1="0" y1="0" x2="1" y2="0">
      <stop offset="0%" stop-color="#ef4444"/>
      <stop offset="100%" stop-color="#f97316"/>
    </linearGradient>
    <filter id="shadow" x="-15%" y="-15%" width="130%" height="130%">
      <feDropShadow dx="0" dy="4" stdDeviation="6" flood-color="#000" flood-opacity="0.45"/>
    </filter>
    <marker id="arrRuntime" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 z" fill="#4ce3ca"/>
    </marker>
    <marker id="arrManual" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 z" fill="#fb923c"/>
    </marker>
    <marker id="arrOk" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 z" fill="#34d399"/>
    </marker>
    <marker id="arrBad" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 z" fill="#f97316"/>
    </marker>
    <style>
      .title { font: 700 34px 'Segoe UI', Arial, sans-serif; fill: #e5efff; letter-spacing: 0.6px; }
      .subtitle { font: 400 16px Consolas, 'Courier New', monospace; fill: #9bc0d4; }
      .laneTitle { font: 700 18px Consolas, 'Courier New', monospace; letter-spacing: 1px; }
      .boxTitle { font: 700 15px Consolas, 'Courier New', monospace; fill: #f8fbff; }
      .boxMeta { font: 400 12px Consolas, 'Courier New', monospace; fill: #b7c6d8; }
      .note { font: 400 12px Consolas, 'Courier New', monospace; fill: #a8b6c8; }
      .chip { font: 700 12px Consolas, 'Courier New', monospace; }
    </style>
  </defs>

  <rect width="1600" height="1120" fill="url(#bg)"/>
  <g opacity="0.05" stroke="#78b0d6" stroke-width="1">
    <path d="M0 80H1600M0 180H1600M0 280H1600M0 380H1600M0 480H1600M0 580H1600M0 680H1600M0 780H1600M0 880H1600M0 980H1600"/>
    <path d="M200 0V1120M400 0V1120M600 0V1120M800 0V1120M1000 0V1120M1200 0V1120M1400 0V1120"/>
  </g>

  <text x="800" y="48" text-anchor="middle" class="title">Runtime Flow | Clean-Lane Format</text>
  <text x="800" y="76" text-anchor="middle" class="subtitle">No crossing arrows through bubbles. Manual gate path and autonomous path are separated then merged.</text>

  <rect x="38" y="104" width="470" height="980" fill="url(#laneLeft)" stroke="#fb923c" stroke-opacity="0.35" stroke-width="1.2"/>
  <rect x="548" y="104" width="530" height="980" fill="url(#laneCenter)" stroke="#34d399" stroke-opacity="0.35" stroke-width="1.2"/>
  <rect x="1118" y="104" width="444" height="980" fill="url(#laneRight)" stroke="#818cf8" stroke-opacity="0.35" stroke-width="1.2"/>

  <text x="56" y="138" class="laneTitle" fill="#fdba74">MANUAL GATE LANE (self_loop_mode=0)</text>
  <text x="566" y="138" class="laneTitle" fill="#86efac">CORE RUNTIME LANE</text>
  <text x="1136" y="138" class="laneTitle" fill="#c4b5fd">TERMINAL &amp; FUSION LANE</text>

  <g filter="url(#shadow)">
    <rect x="646" y="166" width="332" height="64" rx="12" fill="#102532" stroke="#54c8ff" stroke-opacity="0.65"/>
    <text x="666" y="194" class="boxTitle">1) Create Task</text>
    <text x="666" y="214" class="boxMeta">status=queued, participants assigned, defaults loaded</text>

    <rect x="646" y="258" width="332" height="64" rx="12" fill="#102532" stroke="#54c8ff" stroke-opacity="0.65"/>
    <text x="666" y="286" class="boxTitle">2) Start Task + Strategy Bind</text>
    <text x="666" y="306" class="boxMeta">sandbox_mode / self_loop_mode / auto_merge</text>

    <rect x="646" y="350" width="332" height="66" rx="12" fill="#102532" stroke="#67e8f9" stroke-opacity="0.75"/>
    <text x="666" y="378" class="boxTitle">3) Branch on self_loop_mode</text>
    <text x="666" y="398" class="boxMeta">0=manual gate | 1=autonomous</text>
  </g>

  <line x1="812" y1="230" x2="812" y2="258" stroke="#56d6f6" stroke-width="2.5" marker-end="url(#arrRuntime)"/>
  <line x1="812" y1="322" x2="812" y2="350" stroke="#56d6f6" stroke-width="2.5" marker-end="url(#arrRuntime)"/>

  <path d="M646,382 H500 V430" stroke="#fb923c" stroke-width="2.5" fill="none" marker-end="url(#arrManual)"/>
  <text x="492" y="376" class="chip" fill="#fdba74" text-anchor="end">mode=0</text>

  <path d="M978,382 H1048 V620 H978" stroke="#4ce3ca" stroke-width="2.5" fill="none" marker-end="url(#arrRuntime)"/>
  <text x="1056" y="376" class="chip" fill="#99f6e4">mode=1</text>
  <text x="1056" y="395" class="note">skip waiting_manual</text>

  <g filter="url(#shadow)">
    <rect x="98" y="430" width="348" height="58" rx="10" fill="#2b1c10" stroke="#fb923c" stroke-opacity="0.7"/>
    <text x="118" y="454" class="boxTitle">4a) Proposal Discussion</text>
    <text x="118" y="474" class="boxMeta">author drafts approach, risk, test plan</text>

    <rect x="98" y="506" width="348" height="58" rx="10" fill="#2b1c10" stroke="#fb923c" stroke-opacity="0.7"/>
    <text x="118" y="530" class="boxTitle">4b) Proposal Review</text>
    <text x="118" y="550" class="boxMeta">reviewers check safety and feasibility</text>

    <rect x="98" y="582" width="348" height="58" rx="10" fill="#32220f" stroke="#f59e0b" stroke-opacity="0.9"/>
    <text x="118" y="606" class="boxTitle">5) WAITING_MANUAL</text>
    <text x="118" y="626" class="boxMeta">task paused for operator decision</text>

    <rect x="98" y="658" width="348" height="66" rx="10" fill="#2b1c10" stroke="#fb923c" stroke-opacity="0.8"/>
    <text x="118" y="684" class="boxTitle">6) Author Decision</text>
    <text x="118" y="704" class="boxMeta">Approve + Queue / Approve + Start / Reject</text>
  </g>

  <line x1="272" y1="488" x2="272" y2="506" stroke="#fb923c" stroke-width="2.3" marker-end="url(#arrManual)"/>
  <line x1="272" y1="564" x2="272" y2="582" stroke="#fb923c" stroke-width="2.3" marker-end="url(#arrManual)"/>
  <line x1="272" y1="640" x2="272" y2="658" stroke="#fb923c" stroke-width="2.3" marker-end="url(#arrManual)"/>

  <path d="M446,690 H580 V620 H646" stroke="#34d399" stroke-width="2.5" fill="none" marker-end="url(#arrOk)"/>
  <text x="458" y="678" class="chip" fill="#86efac">approve</text>

  <path d="M446,706 H1118" stroke="#f97316" stroke-width="2.5" fill="none" marker-end="url(#arrBad)"/>
  <text x="458" y="724" class="chip" fill="#fdba74">reject</text>

  <g filter="url(#shadow)">
    <rect x="646" y="620" width="332" height="54" rx="10" fill="#103127" stroke="#34d399" stroke-opacity="0.85"/>
    <text x="666" y="644" class="boxTitle">7) Enter Round Loop</text>
    <text x="666" y="662" class="boxMeta">queued->running (or direct from mode=1)</text>

    <rect x="646" y="700" width="332" height="214" rx="14" fill="#0f2a26" stroke="#34d399" stroke-opacity="0.55" stroke-dasharray="6,4"/>
    <text x="666" y="724" class="boxTitle">8) Round Pipeline (1..max_rounds)</text>
    <text x="666" y="747" class="boxMeta">discussion -> implementation -> review -> verify(test+lint)</text>

    <rect x="666" y="766" width="292" height="36" rx="8" fill="#11332c" stroke="#3fe0b2"/>
    <text x="682" y="789" class="boxMeta">8.1 discussion + implementation</text>

    <rect x="666" y="810" width="292" height="36" rx="8" fill="#11332c" stroke="#3fe0b2"/>
    <text x="682" y="833" class="boxMeta">8.2 reviewer checks + proposal feedback</text>

    <rect x="666" y="854" width="292" height="36" rx="8" fill="#11332c" stroke="#3fe0b2"/>
    <text x="682" y="877" class="boxMeta">8.3 verification (pytest + ruff)</text>

    <rect x="646" y="936" width="332" height="58" rx="10" fill="#11403a" stroke="#34d399" stroke-opacity="0.9"/>
    <text x="666" y="960" class="boxTitle">9) Gate Decision</text>
    <text x="666" y="980" class="boxMeta">pass | failed_gate | failed_system / canceled</text>
  </g>

  <line x1="812" y1="674" x2="812" y2="700" stroke="#4ce3ca" stroke-width="2.5" marker-end="url(#arrRuntime)"/>
  <line x1="812" y1="914" x2="812" y2="936" stroke="#4ce3ca" stroke-width="2.5" marker-end="url(#arrRuntime)"/>

  <path d="M978,964 H1118" stroke="#34d399" stroke-width="2.5" fill="none" marker-end="url(#arrOk)"/>
  <text x="988" y="952" class="chip" fill="#86efac">pass</text>

  <path d="M812,994 V1038 H646 V994" stroke="#f59e0b" stroke-width="2.4" fill="none" marker-end="url(#arrManual)"/>
  <text x="824" y="1028" class="chip" fill="#fdba74">failed_gate -> next round</text>

  <path d="M978,986 H1118" stroke="#f97316" stroke-width="2.5" fill="none" marker-end="url(#arrBad)"/>
  <text x="988" y="1004" class="chip" fill="#fca5a5">system fail / canceled</text>

  <g filter="url(#shadow)">
    <rect x="1144" y="672" width="392" height="58" rx="10" fill="#2b1717" stroke="#f97316" stroke-opacity="0.8"/>
    <text x="1166" y="696" class="boxTitle">REJECTED</text>
    <text x="1166" y="716" class="boxMeta">manual reject -> canceled</text>

    <rect x="1144" y="830" width="392" height="64" rx="10" fill="#14392e" stroke="#34d399" stroke-opacity="0.9"/>
    <text x="1166" y="856" class="boxTitle">PASSED</text>
    <text x="1166" y="876" class="boxMeta">quality gate reached</text>

    <rect x="1144" y="912" width="392" height="86" rx="10" fill="#123626" stroke="#34d399" stroke-opacity="0.9"/>
    <text x="1166" y="938" class="boxTitle">10) Auto Fusion (default auto_merge=1)</text>
    <text x="1166" y="958" class="boxMeta">merge changes + append CHANGELOG.auto.md</text>
    <text x="1166" y="978" class="boxMeta">create snapshot + cleanup generated sandbox</text>

    <rect x="1144" y="1018" width="188" height="56" rx="10" fill="#321919" stroke="#ef4444" stroke-opacity="0.9"/>
    <text x="1162" y="1050" class="boxTitle">FAILED_SYSTEM</text>

    <rect x="1348" y="1018" width="188" height="56" rx="10" fill="#3a2415" stroke="#f97316" stroke-opacity="0.9"/>
    <text x="1370" y="1050" class="boxTitle">CANCELED</text>
  </g>

  <path d="M1536,986 V1018" stroke="#f97316" stroke-width="2.5" fill="none" marker-end="url(#arrBad)"/>
  <path d="M1220,986 V1018" stroke="#ef4444" stroke-width="2.5" fill="none" marker-end="url(#arrBad)"/>
  <path d="M1340,862 H1144" stroke="#34d399" stroke-width="2.5" fill="none" marker-end="url(#arrOk)"/>

  <g>
    <rect x="56" y="1004" width="442" height="64" rx="10" fill="#111827" stroke="#94a3b8" stroke-opacity="0.4"/>
    <text x="76" y="1029" class="boxMeta">Legend:</text>
    <text x="76" y="1049" class="note">cyan/green arrows = normal progress, orange = manual gate operations, red = terminal failure path</text>
  </g>
</svg>
